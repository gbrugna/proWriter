<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ProWriter</title>
    <link rel="stylesheet" href="style/common.css">
    <link rel="stylesheet" href="style/profile.css"/>
    <link rel="stylesheet" href="style/fixed_buttons.css">
    <script src="js/profile.js"></script>
</head>
<body>
<button id="go_home" onclick="location.href='/'"></button>
<div id="tabs-profile">
    <button class="tab" onclick="location.href='/account'">Mio profilo</button>
    <button class="tab" onclick="location.href='/friends'">Amici</button>
    <button class="tab tab_selected">Amministratore</button>
</div>
<div id="add-text-container" class="container invisible">
    <textarea class="generic-input resize-vertical" id="text-to-add"
              placeholder="Inserisci il testo da aggiungere..."></textarea>
    <br>
    <div id="outcomeAddText" class="invisible"></div>
    <button class="generic" onclick="cancel('add')">Annulla</button>
    <button class="generic" onclick="toServer('add')" id="addBtn">Aggiungi</button>
</div>
<div id="remove-text-container" class="container invisible">
    <div id="texts"></div>
    <button class="generic" onclick="cancel('remove')">Annulla</button>
</div>

<div id="tab-container" class="container">
    <button class="generic" onclick="text('add')">Aggiungi testo</button>
    <button class="generic" onclick="text('remove'); loadTexts()">Rimuovi testo</button>
</div>

<script>
    async function loadTexts(){
        await fetch('/api/v1/texts/')
        .then(res => res.json())
        .then(res => {
            while(document.getElementById('texts').firstChild)
                document.getElementById('texts').removeChild(document.getElementById('texts').firstChild);
            
            res.forEach(res => {
                let textItem = document.createElement('div');
                textItem.classList.add('text-item');
                textItem.id = res.id;
                textItem.innerHTML = '<p class="text">' + res.content + '</p>';

                let btn = document.createElement('button');
                btn.setAttribute('class','generic red remove-text-button text-item-buttons');
                
                let btnColumn = document.createElement('div');
                btnColumn.classList.add('text-btn-column');
                btn.setAttribute('onclick', `deleteText('${res.id}', this)`);
                btnColumn.appendChild(btn);
                textItem.appendChild(btnColumn);
                document.getElementById('texts').appendChild(textItem);
            });
        });
    }
    function deleteText(id, btn){
        btn.setAttribute('onclick', '');
        fetch(`/api/v1/texts/${id}`, {
            method : 'DELETE'
        })
        .then(res => {
            if (res.status == 204)
                deleteTextUI(id);
            else if(res.status == 404)
                console.log('Errore: testo non trovato'); 
        });
    }

    function deleteTextUI(id){
        document.getElementById(id).classList.add('fade-out');
        setTimeout(()=>{document.getElementById(id).remove()}, 500);
    }

</script>
</body>
</html>